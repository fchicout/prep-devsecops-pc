---
- name: Ensure repository and GPG key states are consistent
  ansible.builtin.include_tasks: _cleanup_repo.yml
  loop:
    - { repo_name: 'docker', gpg_name: '/etc/apt/keyrings/docker.gpg' }
    - { repo_name: 'hashicorp', gpg_name: '/etc/apt/keyrings/hashicorp.gpg' }
    - { repo_name: 'vscode', gpg_name: '/usr/share/keyrings/microsoft.gpg' }
    - { repo_name: 'virtualbox', gpg_name: '/etc/apt/keyrings/oracle-virtualbox-2016.gpg' }
  loop_control:
    loop_var: repo_info

- name: Install common prerequisites for external repositories
  ansible.builtin.apt:
    name:
      - apt-transport-https
      - ca-certificates
      - curl
      - gpg
      - gnupg
      - htop
      - nload
      - python3-pip
      - python3-venv
      - wget
      - git
    state: present
  become: yes


- name: Create directory for GPG keys if it does not exist
  ansible.builtin.file:
    path: /etc/apt/keyrings
    state: directory
    mode: '0755'
  become: yes